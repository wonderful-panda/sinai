/*!
 * Sinai v0.1.6
 * https://github.com/ktsn/sinai
 *
 * @license
 * Copyright (c) 2017 katashin
 * Released under the MIT license
 * https://github.com/ktsn/sinai/blob/master/LICENSE
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Sinai={})}(this,function(t){"use strict";function e(t,e){function n(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function n(t,e){if(!t)throw new Error("[sinai] "+e)}function r(t){return t}function o(t,e){Object.keys(t).forEach(function(n){e(t[n],n)})}function i(t,e){return t.reduce(function(t,e){return t[e]},e)}function u(t,e){return function(){return e.apply(t,arguments)}}function s(t){return null!=t&&"function"==typeof t.then}function c(t,e,n){return{Getters:function(){return t},Mutations:function(){return e},Actions:function(){return n},and:function(r,o){return c(a(t,r,o),e,a(n,r,o))}}}function a(t,n,r){return function(t){function o(e,o){var i=t.call(this,e,o)||this,u=o.getProxy(r);return i.modules[n]=u,i}return e(o,t),o}(t)}function f(t,e,n){t.constructor!==e&&(Object.getOwnPropertyNames(t).forEach(function(e){if("constructor"!==e){var r=Object.getOwnPropertyDescriptor(t,e);n(r,e)}}),f(Object.getPrototypeOf(t),e,n))}function p(t,e){function n(t,r,o){return Object.keys(o).forEach(function(i){"__proxy__"!==i&&"modules"!==i&&(o[i].__proto__ instanceof b?n(t,r.concat(i),o[i]):Object.defineProperty(t,r.concat(i).join(e),{get:function(){return o[i]},enumerable:!0,configurable:!0}))}),t}return n({},[],t)}function h(t,e){return function(n,r){return e(n,t.concat(r))}}function l(){var t=this,e=t.$options.store;e?t.$store=e:t.$parent&&t.$parent.$store&&(t.$store=t.$parent.$store)}var y,d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},g=function(){return function(t,e){var n=e.getProxy(t);this.__proxy__=n}}(),m=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.modules={},e}return e(n,t),n}(g),b=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"state",{get:function(){return this.__proxy__.state},enumerable:!0,configurable:!0}),n}(m),v=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"state",{get:function(){return this.__proxy__.state},enumerable:!0,configurable:!0}),n}(g),_=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),Object.defineProperty(n.prototype,"state",{get:function(){return this.__proxy__.state},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"getters",{get:function(){return this.__proxy__.getters},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mutations",{get:function(){return this.__proxy__.mutations},enumerable:!0,configurable:!0}),n}(m),M=function(){function t(t,e){var n=e.state,r=e.getters,o=e.mutations,i=e.actions;this.uid=t,this.children={},this.State=n,this.Getters=r,this.Mutations=o,this.Actions=i}return t.prototype.initState=function(){return this.State?new this.State:{}},t.prototype.initGetters=function(t,e){if(void 0===e&&(e=r),!this.Getters)return{};var n=new this.Getters(this,t);return f(this.Getters.prototype,b,function(t,r){if("function"==typeof t.get){var o=t.get;t.get=function(){return o.call(n)}}else if("function"==typeof t.value){var i=t.value;t.value=function(){return i.apply(n,arguments)}}Object.defineProperty(n,r,e(t,r))}),n},t.prototype.initMutations=function(t,e){if(void 0===e&&(e=r),!this.Mutations)return{};var n=new this.Mutations(this,t);return f(this.Mutations.prototype,v,function(t,r){var o=t.value;t.value=function(){o.apply(n,arguments)},Object.defineProperty(n,r,e(t,r))}),n},t.prototype.initActions=function(t,e){if(void 0===e&&(e=r),!this.Actions)return{};var n=new this.Actions(this,t);return f(this.Actions.prototype,_,function(t,r){var o=t.value;t.value=function(){return o.apply(n,arguments)},Object.defineProperty(n,r,e(t,r))}),n},t.prototype.child=function(t,e){return this.children[t]=e,this},t}(),O=function(){function t(t,e){this.path=t,this.store=e}return Object.defineProperty(t.prototype,"state",{get:function(){return i(this.path,this.store.state)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"getters",{get:function(){return i(this.path,this.store.getters)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mutations",{get:function(){return i(this.path,this.store.mutations)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){return i(this.path,this.store.actions)},enumerable:!0,configurable:!0}),t}(),j=0,w=function(){function t(t,e){void 0===e&&(e={}),this.moduleMap={},this.subscribers=[],this.transformGetter=e.transformGetter||r,this.transformMutation=e.transformMutation||r,this.transformAction=e.transformAction||r,this.registerModule(t,!1)}return t.prototype.replaceState=function(t){this.state=t},t.prototype.subscribe=function(t){var e=this;return this.subscribers.push(t),function(){e.subscribers.splice(e.subscribers.indexOf(t),1)}},t.prototype.registerModule=function(t,e){this.registerModuleLoop([],t);var n=this.initModuleAssets([],t);e||(this.state=n.state),this.getters=n.getters,this.mutations=n.mutations,this.actions=n.actions},t.prototype.getProxy=function(t){var e=this.moduleMap[t.uid];return null==e?null:e.proxy},t.prototype.hotUpdate=function(t){this.moduleMap={},this.registerModule(t,!0)},t.prototype.registerModuleLoop=function(t,e){var n=this;this.moduleMap[e.uid]={path:t,module:e,proxy:new O(t,this)},Object.keys(e.children).forEach(function(r){n.registerModuleLoop(t.concat(r),e.children[r])})},t.prototype.initModuleAssets=function(t,e){var n=this,r={state:e.initState(),getters:e.initGetters(this,h(t,this.transformGetter)),mutations:e.initMutations(this,h(t,u(this,this.hookMutation))),actions:e.initActions(this,h(t,this.transformAction))};return o(e.children,function(e,o){var i=n.initModuleAssets(t.concat(o),e);r.state[o]=i.state,r.getters[o]=i.getters,r.mutations[o]=i.mutations,r.actions[o]=i.actions}),r},t.prototype.hookMutation=function(t,e){var n=this,r=t.value;return t.value=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];r.apply(void 0,t),n.subscribers.forEach(function(r){return r(e,t,n.state)})},this.transformMutation(t,e)},t}(),P=("undefined"!=typeof window&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__,function(){function t(t,e){var r=this;this.gettersForComputed={},this.strict=Boolean(e.strict),this.innerStore=new w(t,{transformGetter:u(this,this.transformGetter),transformMutation:u(this,this.transformMutation)}),this.setupStoreVM(),this.watcher=new y,Object.defineProperty(this.innerStore,"state",{get:function(){return r.state},set:function(t){r.vm.$data.state=t}}),this.strict&&this.watch(function(t){return t},function(){n(!r.strict,"Must not update state out of mutations when strict mode is enabled.")},{deep:!0,sync:!0});var o=e.plugins||[];o.forEach(function(t){return t(r)})}return Object.defineProperty(t.prototype,"state",{get:function(){return this.vm.$data.state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"getters",{get:function(){return this.innerStore.getters},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mutations",{get:function(){return this.innerStore.mutations},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actions",{get:function(){return this.innerStore.actions},enumerable:!0,configurable:!0}),t.prototype.replaceState=function(t){var e=this;this.commit(function(){e.vm.$data.state=t})},t.prototype.subscribe=function(t){return this.innerStore.subscribe(t)},t.prototype.watch=function(t,e,n){var r=this;return this.watcher.$watch(function(){return t(r.state,r.getters)},e,n)},t.prototype.hotUpdate=function(t){this.gettersForComputed={},this.innerStore.hotUpdate(t),this.setupStoreVM()},t.prototype.transformGetter=function(t,e){var n=this;if("function"!=typeof t.get)return t;var r=e.join(".");return this.gettersForComputed[r]=t.get,t.get=function(){return n.vm[r]},t},t.prototype.transformMutation=function(t){var e=this;if(!this.strict)return t;var n=t.value;return t.value=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.commit(function(){return n.apply(null,t)})},t},t.prototype.setupStoreVM=function(){var t=this.vm;this.vm=new y({data:{state:this.innerStore.state},computed:this.gettersForComputed}),null!=t&&(this.commit(function(){t.$data.state=null}),y.nextTick(function(){t.$destroy()}))},t.prototype.commit=function(t){var e=this.strict;this.strict=!1,t(),this.strict=e},t}());t.module=function(t){return void 0===t&&(t={}),new M(++j,t)},t.inject=function(t,e){return c(b,v,_).and(t,e)},t.Getters=function(){return b},t.Mutations=function(){return v},t.Actions=function(){return _},t.convertVuexPlugin=function(t){return function(e){var n={get state(){return e.state},get getters(){return p(e.getters,"/")},replaceState:function(t){e.replaceState(t)},dispatch:function(t,n){"string"!=typeof t&&(t=(n=t).type);var r=t.split("/").reduce(function(t,e){return t[e]},e.actions)(n);return s(r)?r:Promise.resolve(r)},commit:function(t,n){"string"!=typeof t&&(t=(n=t).type),t.split("/").reduce(function(t,e){return t[e]},e.mutations)(n)},subscribe:function(t){return e.subscribe(function(e,n,r){var o=e.join("/");t({type:o,payload:n[0]},r)})},watch:function(t,n,r){var o=this;return e.watch(function(){return t(o.state,o.getters)},n,r)},registerModule:function(){throw new Error("[sinai:vuex-plugin-adapter] registerModule is not supported")},unregisterModule:function(){throw new Error("[sinai:vuex-plugin-adapter] unregisterModule is not supported")}};t(n)}},t.store=function(t,e){return void 0===e&&(e={}),new P(t,e)},t.install=function(t){(y=t).mixin({beforeCreate:l})},Object.defineProperty(t,"__esModule",{value:!0})});
